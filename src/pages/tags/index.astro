---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import TagFilter from '../../components/TagFilter.astro';

// Get all posts and extract tags with counts
const allPosts = await getCollection('blog');
const tagCounts = new Map<string, number>();

allPosts.forEach(post => {
  post.data.tags.forEach(tag => {
    tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
  });
});

// Sort tags by count descending
const sortedTags = Array.from(tagCounts.entries())
  .sort((a, b) => b[1] - a[1]);
---

<BaseLayout title="Tags" description="Browse blog posts by tag">
  <div class="max-w-4xl mx-auto">
    <div class="mb-12">
      <h1 class="text-4xl font-bold mb-4 text-gray-900 dark:text-white">Tags</h1>
      <p class="text-lg text-gray-600 dark:text-gray-400">
        Explore posts organized by topic
      </p>
    </div>

    {sortedTags.length > 0 ? (
      <div class="flex flex-wrap gap-3">
        {sortedTags.map(([tag, count]) => (
          <TagFilter tag={tag} count={count} />
        ))}
      </div>
    ) : (
      <div class="text-center py-12 text-gray-500 dark:text-gray-400">
        <p class="text-lg">No tags yet. Check back soon!</p>
      </div>
    )}
  </div>
</BaseLayout>
