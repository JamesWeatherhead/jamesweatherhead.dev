---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const tagCounts = new Map<string, number>();

allPosts.forEach(post => {
  post.data.tags.forEach(tag => {
    tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
  });
});

const sortedTags = Array.from(tagCounts.entries())
  .sort((a, b) => b[1] - a[1]);
---

<BaseLayout title="Tags" description="Browse posts by topic.">
  <div style="max-width: 720px; margin: 0 auto; padding: 0 1.5rem;">

    <section style="padding: 4rem 0 2rem;">
      <h1 style="font-family: var(--font-display); font-weight: 400; font-size: clamp(2rem, 5vw, 3rem); line-height: 1.1; margin: 0 0 1rem 0; color: var(--color-text-primary);">
        Tags
      </h1>
    </section>

    <section style="padding: 1rem 0 4rem;">
      {sortedTags.length > 0 ? (
        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
          {sortedTags.map(([tag, count]) => (
            <a
              href={`/tags/${tag.toLowerCase().replace(/\s+/g, '-')}`}
              class="tag-pill"
              style="text-decoration: none;"
            >
              {tag} ({count})
            </a>
          ))}
        </div>
      ) : (
        <p style="font-family: var(--font-body); font-size: 0.95rem; color: var(--color-text-secondary); font-style: italic;">
          No tags yet.
        </p>
      )}
    </section>

  </div>
</BaseLayout>
